!function(e){"use strict";var t=document.createElement("script");t.appendChild(document.createTextNode("("+e.toString()+"());")),document.body.appendChild(t)}(function(){"use strict";function e(e,t){for(var n=0;n<e.length;n++)t(e[n],n,e)}function t(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return!0;return!1}function n(e,t){for(var n=0;n<e.length;n++)if(!t(e[n]))return!1;return!0}function a(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function o(e,t){return e=e.toLowerCase(),e.indexOf(t.toLowerCase())>=0}function r(e){H.push(e)}function i(){e(H,function(e){e()})}function s(t){e(j,function(e){if(!(e in t))throw new Error("Missing param "+e)}),a(t,function(e){if(j.indexOf(e)<0&&P.indexOf(e)<0)throw new Error("Unexpected param "+e)});var n=this;a(t,function(e,t){n[e]=t}),this._value=null,this._observers=[]}function l(e){var t=new s(e);U.push(t),q[t.name]=t,t.message_filter&&R.push(t),t.message_css&&G.push(t),t.message_rewriter&&J.push(t)}function c(e){return q[e].getValue()}function u(e){var t=localStorage.getItem(e);return t?JSON.parse(t):null}function m(e,t){localStorage.setItem(e,JSON.stringify(t))}function f(){var t={},n=u(Y);n&&a(q,function(a){e(["filters","rewriters","stylers"],function(e){n[e].indexOf(a)>=0&&(t[a]=!0)})});var o=u(K);return o&&(t.TppBanCustomWords=!0,t.TppBannedWords=o),t}function d(){var e;e=window.localStorage?u(X)||f():{},a(q,function(t,n){t in e?n.setValue(e[t]):n.setValue(null)})}function p(){if(window.localStorage){var e={};a(q,function(t,n){null!==n._value&&(e[t]=n._value)}),m(X,e),localStorage.removeItem(Y),localStorage.removeItem(K)}}function g(e){$("head").append("<style>"+e.join("")+"</style>")}function h(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;var n,a,o=[];for(n=0;n<=t.length;n++)o[n]=[n];for(a=0;a<=e.length;a++)o[0][a]=a;for(n=1;n<=t.length;n++)for(a=1;a<=e.length;a++)t.charAt(n-1)===e.charAt(a-1)?o[n][a]=o[n-1][a-1]:o[n][a]=1+Math.min(o[n-1][a-1],o[n][a-1],o[n-1][a]);return o[t.length][e.length]}function v(e){return t(oe,function(t){return h(t.toLowerCase(),e.toLowerCase())<=re})}function y(e){return/^([0-9]+),([0-9]+)$/.test(e.replace(/\s/g,""))?!0:/^\s*item[a-z0-9]*\s*$/i.test(e)?!0:n(e.split(/\s+/),function(e){if(e.length<=0)return!0;var t=e.match(/(?:([a-z]+)[^a-z]{0,2})+/gi);return t&&n(t,function(e){var t=e.match(/[a-z]+/gi);return n(t,v)})})}function w(t){var n=0;return e(ie,function(e){o(t,e)&&n++}),n>=2}function b(e){for(var t=0,n=0;n<e.length;n++){var a=e.charCodeAt(n);a>=9600&&9632>=a&&t++}return t>3}function _(e){return/[\u0400-\u04FF]/.test(e)}function C(e){for(var t=0,n=0;n<e.length;n++){var a=e.charCodeAt(n);se.indexOf(a)>=0&&t++}return t>1}function x(e){return e.split(/\s/g).length<=1}function T(e){return e.length>=200}function V(e){return/^\s*\!/.test(e)}function k(e,t){return"tppbankbot"===t.toLowerCase()?le?e.toLowerCase().indexOf("@"+le.toLowerCase())<0:!0:!1}function S(e){return e.replace(/(.{4}.*?)(\s*?\1)+/g,"$1")}function N(e){return e.replace(/[\u0300-\u036F]/g,"")}function O(t){var n=t;return e(ce,function(e){n=n.replace(e,"")}),/^\s*$/.test(n)}function B(e){var n=c("TppBanCustomWords"),a=c("TppBannedWords");return n&&t(a,function(t){return o(e,t)})}function F(t,n){var a={};return t=t||"",n=n||"",e(R,function(e){a[e.name]=e.message_filter(t,n)}),a}function M(e){var t=Date.now();pe=t,he=ge,ge={text:e,time:t}}function A(){ge=he,he=null}function D(e){var t;if(/now in slow mode/.test(e)&&(t=/(\d+) second/.exec(e))){if(fe==Number(t[1]))return!1;fe=Number(t[1])}if(/identical to the previous/.test(e)&&(t=/than (\d+) second/.exec(e),t&&(de=Number(t[1])),A()),/you are sending messages too quickly/.test(e)){if(t=/in (\d+) second/.exec(e)){var n=Number(t[1]),a=Date.now()-ge.time+1e3*n;fe=Math.ceil(a/1e3)}A()}if(/You are banned/.test(e)){if(t=/for (\d+) more second/.exec(e)){var o=Number(t[1]);ve=Date.now()+1e3*o}A()}return I(),!0}function E(e){var t=Date.now();if(ve){var n=ve-t;if(n>0)return{blocked:!0,error:"you are banned",wait:n}}if(ge){var a=pe+me-t;if(a>0)return{blocked:!0,error:"",wait:null};if(e===ge.text){var o=ge.time+1e3*de-t;if(o>0)return{blocked:!0,error:"repeated message",wait:o}}var r=ge.time+1e3*fe-t;if(r>0)return{blocked:!0,error:"slowmode",wait:r}}return{blocked:!1}}function I(){var e=$(ne).val(),t=E(e),n=$(ae);if(c("TppSlowmodeHelper")&&t.blocked){var a;a=t.error?"Wait "+Math.ceil(t.wait/1e3)+" seconds ("+t.error+")":"...",n.addClass(we),n.text(a),_e=!1}else _e||(n.removeClass(we),n.text(be),_e=!0)}function W(){i(),d(),console.log(z)}if(window.$){var L="3.6",z="TPP Chat Filter version "+L+" loaded. Please report bugs and suggestions to https://github.com/jpgohlke/twitch-chat-filter",H=[],j=["name","comment","category","defaultValue"],P=["longComment","message_filter","message_css","message_rewriter"];s.prototype.getValue=function(){return null!==this._value?this._value:this.defaultValue},s.prototype.setValue=function(t){var n=this.getValue();this._value=t;var a=this.getValue();e(this._observers,function(e){e(a,n)})},s.prototype.reset=function(){this.setValue(null)},s.prototype.observe=function(e){this._observers.push(e)},s.prototype.forceObserverUpdate=function(){var t=this.getValue();e(this._observers,function(e){e(t,t)})};var U=[],q={},R=[],J=[],G=[],X="tpp-chat-filter-settings",Y="tpp-custom-filter-active",K="tpp-custom-filter-phrases";r(function(){e(U,function(e){e.observe(function(){p()})})});var Q=".chat-room",Z=".message",ee=".from",te=".chat-line",ne=".chat-interface textarea",ae="button.send-chat-button",oe=["left","right","up","down","start","select","a","b","l","r","democracy","anarchy","wait","move","switch","run","item"],re=2;l({name:"TppFilterCommand",comment:"Emulator commands",longComment:oe.join(", "),category:"filters_category",defaultValue:!0,message_filter:y});var ie=["misty","whitney","milk","guys","we have to","we need to","beat"];l({name:"TppFilterMisty",comment:"Misty meme",longComment:"Guys we need to milk Witney",category:"filters_category",defaultValue:!0,message_filter:w}),l({name:"TppFilterAscii",comment:"Blocky drawings",longComment:"Stuff like this: ░░░░▒▒▒▒▌ ▀▒▀▐▄█",category:"filters_category",defaultValue:!0,message_filter:b}),l({name:"TppFilterCyrillic",comment:"Cyrillic",longComment:"Cyrillic characters in copypastas confuse our other filters",category:"filters_category",defaultValue:!0,message_filter:_});var se=[3720,9685,664,8362,3232,176,8248,8226,7886,3237];l({name:"TppFilterDonger",comment:"Dongers",longComment:"ヽ༼ຈل͜ຈ༽ﾉ",category:"filters_category",defaultValue:!1,message_filter:C}),l({name:"TppFilterSmall",comment:"One-word messages",category:"filters_category",defaultValue:!1,message_filter:x}),l({name:"TppFilterLong",comment:"Overly long messages",longComment:"Hide messages over 200 characters (around 4 lines)",category:"filters_category",defaultValue:!1,message_filter:T}),l({name:"TppFilterBets",comment:"Stadium bets",longComment:'Any message starting with a "!". ex.: "!bet 100 blue"',category:"filters_category",defaultValue:!0,message_filter:V});var le=null;r(function(){Twitch&&(le=Twitch.user.displayName())}),l({name:"TppFilterBankBot",comment:"Stadium bank bot",longComment:"Messages from the bank bot about other players' balances",category:"filters_category",defaultValue:!0,message_filter:k}),l({name:"TppRewriteDuplicates",comment:"Copy pasted repetitions",category:"rewriters_category",defaultValue:!0,message_rewriter:S}),l({name:"TppMopUpDrinks",comment:"Mop up spilled drinks",category:"rewriters_category",defaultValue:!0,message_rewriter:N}),l({name:"TppConvertAllcaps",comment:"Lowercase everything",longComment:null,category:"visual_category",defaultValue:!0,message_css:Z+"{text-transform:lowercase !important;}"});var ce=[];r(function(){Twitch&&Twitch.api.get("chat/emoticons").then(function(t){e(t.emoticons,function(e){var t=e.regex;t.match(/^\w+$/)&&(t="\\b"+t+"\\b"),ce.push(new RegExp(t,"g"))})})}),l({name:"TppHideEmoticons",comment:"Hide emoticons",category:"visual_category",defaultValue:!1,message_css:Z+" .emoticon{display:none !important;}",message_filter:O}),l({name:"TppNoColor",comment:"Uncolor messages",longComment:"Remove color from messages created with the /me command",category:"visual_category",defaultValue:!1,message_css:Z+" {color:inherit !important;}"}),l({name:"TppBanCustomWords",comment:"Activate custom banlist",longComment:"",category:"customs_category",defaultValue:!1,message_css:"#menu-TppBannedWords { display:inherit; }"}),r(function(){g(["#menu-TppBannedWords { display:none; }"])}),l({name:"TppBannedWords",comment:"Banned Phrases",longComment:"If the custom banlist is activated, these messages will be hidden",category:"customs_category",defaultValue:[],message_filter:B});var ue=".chat-settings";r(function(){function t(){var e=s.height();e>0&&i.css("max-height",.9*e)}function n(e,t){e.append($("<label>").attr("for",t.name).attr("title",t.longComment||"").append($('<input type="checkbox">').attr("id",t.name)).append(document.createTextNode(" "+t.comment)));var n=$("#"+t.name);n.on("change",function(){t.setValue($(this).prop("checked"))}),t.observe(function(e){n.prop("checked",e)})}function a(t,n){function a(e){var t=n.getValue().slice();t.indexOf(e)<0&&(t.push(e),n.setValue(t))}function o(e){var t=n.getValue().slice();t.splice(e,1),n.setValue(t)}function r(){$("#show-"+n.name).show(),$("#hide-"+n.name).hide(),$("#clear-"+n.name).hide(),$("#list-"+n.name).hide()}function i(){$("#show-"+n.name).hide(),$("#hide-"+n.name).show(),$("#clear-"+n.name).show(),$("#list-"+n.name).show()}t.append($("<label>").attr("for",n.name).attr("title",n.longComment||"").append(document.createTextNode("Add "+n.comment)).append($('<input type="text">').attr("id",n.name).css("width","100%"))).append($("<button>").attr("id","show-"+n.name).append(document.createTextNode("Show ")).append($("<span>").attr("id","num-banned-"+n.name)).append(document.createTextNode(" "+n.comment))).append($("<button>").attr("id","hide-"+n.name).append(document.createTextNode("Hide "+n.comment))).append($('<div class="custom_list_menu">').attr("id","list-"+n.name)).append($("<button>").attr("id","clear-"+n.name).append(document.createTextNode("Clear "+n.comment))),r(),n.observe(function(t){$("#num-banned-"+n.name).text(t.length);var a=$("#list-"+n.name);a.empty(),e(t,function(e,t){a.append($("<li>").text(e).append($('<a href="#">').text("[X]").click(function(){o(t)})))})}),$("#"+n.name).keyup(function(e){var t=$(this).val().trim();13===e.keyCode&&""!==t&&(a(t),$(this).val(""))}),$("#show-"+n.name).click(function(e){e.preventDefault(),i()}),$("#hide-"+n.name).click(function(e){e.preventDefault(),r()}),$("#clear-"+n.name).click(function(e){e.preventDefault(),n.setValue([])})}function o(e){$('<div class="list-header"/>').text(e).appendTo(i);var t=$('<div class="chat-menu-content">').appendTo(i);return t}function r(t,o){e(U,function(e){if(e.category===o){var r=$("<p>").attr("id","menu-"+e.name).addClass("dropmenu_action").appendTo(t),i=typeof e.defaultValue;if("boolean"===i)n(r,e);else{if("object"!==i)throw new Error("Unrecognized setting "+i);a(r,e)}}})}g([".chat-room { z-index: inherit !important; }",".chat-settings { z-index: 100 !important; }",".custom_list_menu li {background: #bbb; display: block; list-style: none; margin: 1px 0; padding: 0 2px}",".custom_list_menu li a {float: right;}"]);var i=$(ue),s=$(Q);i.css("overflow-y","auto"),t(),setInterval(t,500),$(window).resize(t);var l=o("Hide");r(l,"filters_category");var c=o("Automatically rewrite");r(c,"rewriters_category");var u=o("Visual tweaks");r(u,"visual_category");var m=o("Custom Banlist");r(m,"customs_category");var f=o("Misc");f.append($("<button>Reset TPP filter settings</a>").click(function(){confirm("This will reset all Twitch Chat Filter settings to their default values and will delete all custom banned phrases. Are you sure you want to continue?")&&e(U,function(e){e.reset()})}))}),r(function(){var t=[];e(G,function(e){t.push(Q+"."+e.name+" "+e.message_css)}),g(t),e(G,function(e){e.observe(function(t){$(Q).toggleClass(e.name,t)})})}),r(function(){var t=[];e(R,function(e){var n=e.name,a=e.name+"Hidden";t.push(Q+"."+a+" "+te+"."+n+","+Q+"."+a+" ."+n+" "+te+"{display:none}"),e.observe(function(){$(Q).toggleClass(a,e.getValue())})}),g(t)}),r(function(){var t=require("web-client/components/chat/chat-line/component")["default"].prototype,n=t.didInsertElement;t.didInsertElement=function(){n.apply(this,arguments);var e=this.$(),t=F(this.get("msgObject.message"),this.get("msgObject.from"));for(var a in t)e.toggleClass(a,t[a])},$(te).each(function(){var t=$(this),n=t.find(Z).text().trim(),a=t.find(ee).text().trim();e(R,function(e){t.toggleClass(e.name,e.message_filter(n,a))})})});var me=1e3,fe=2,de=30,pe=null,ge=null,he=null,ve=null,ye=500,we="tpp-slowmode-warning",be=null,_e=!0;if(r(function(){be=$(ae).text(),g(["."+we+"{ opacity:0.7 !important}"]),$(ne).keyup(function(e){13!==e.keyCode&&I()}),setInterval(function(){I()},ye)}),l({name:"TppSlowmodeHelper",comment:"Slowmode helper",longComment:"Shows a countdown of how long you need to wait until being able to chat again",category:"visual_category",defaultValue:!0}),r(function(){var e=require("web-client/models/room")["default"].prototype,t=e.addMessage;e.addMessage=function(e){return"admin"!==e.style||D(e.message)?t.apply(this,arguments):!1};var n=e.send;e.send=function(e){return M(e),n.apply(this,arguments)}}),$(ue).length)W();else{var $e=require("web-client/views/chat")["default"].prototype,Ce=$e.didInsertElement;$e.didInsertElement=function(){Ce&&Ce.apply(this,arguments),W()}}}});