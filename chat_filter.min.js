!function(e){"use strict";var t=document.createElement("script");t.appendChild(document.createTextNode("("+e.toString()+"());")),document.body.appendChild(t)}(function(){"use strict";function e(e,t){for(var n=0;n<e.length;n++)t(e[n],n,e)}function t(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return!0;return!1}function n(e,t){for(var n=0;n<e.length;n++)if(!t(e[n]))return!1;return!0}function a(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function r(e,t){return e=e.toLowerCase(),e.indexOf(t.toLowerCase())>=0}function o(e){j.push(e)}function i(){e(j,function(e){e()})}function s(t){e(z,function(e){if(!(e in t))throw new Error("Missing param "+e)}),a(t,function(e){if(z.indexOf(e)<0&&P.indexOf(e)<0)throw new Error("Unexpected param "+e)});var n=this;a(t,function(e,t){n[e]=t}),this._value=null,this._observers=[]}function l(e){var t=new s(e);U.push(t),q[t.name]=t,t.message_filter&&R.push(t),t.message_css&&G.push(t),t.message_rewriter&&J.push(t)}function c(e){return q[e].getValue()}function u(e){var t=localStorage.getItem(e);return t?JSON.parse(t):null}function m(e,t){localStorage.setItem(e,JSON.stringify(t))}function f(){var t={},n=u(Y);n&&a(q,function(a){e(["filters","rewriters","stylers"],function(e){n[e].indexOf(a)>=0&&(t[a]=!0)})});var r=u(K);return r&&(t.TppBanCustomWords=!0,t.TppBannedWords=r),t}function d(){var e;e=window.localStorage?u(X)||f():{},a(q,function(t,n){n.setValue(t in e?e[t]:null)})}function p(){if(window.localStorage){var e={};a(q,function(t,n){null!==n._value&&(e[t]=n._value)}),m(X,e),localStorage.removeItem(Y),localStorage.removeItem(K)}}function g(e){$("head").append("<style>"+e.join("")+"</style>")}function h(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;var n,a,r=[];for(n=0;n<=t.length;n++)r[n]=[n];for(a=0;a<=e.length;a++)r[0][a]=a;for(n=1;n<=t.length;n++)for(a=1;a<=e.length;a++)r[n][a]=t.charAt(n-1)===e.charAt(a-1)?r[n-1][a-1]:1+Math.min(r[n-1][a-1],r[n][a-1],r[n-1][a]);return r[t.length][e.length]}function v(e){return t(rt,function(t){return h(t.toLowerCase(),e.toLowerCase())<=ot})}function y(e){return/^([0-9]+),([0-9]+)$/.test(e.replace(/\s/g,""))?!0:n(e.split(/\s+/),function(e){if(e.length<=0)return!0;var t=e.match(/(?:([a-z]+)[^a-z]{0,2})+/gi);return t&&n(t,function(e){var t=e.match(/[a-z]+/gi);return n(t,v)})})}function w(t){var n=0;return e(it,function(e){r(t,e)&&n++}),n>=2}function b(e){for(var t=0,n=0;n<e.length;n++){var a=e.charCodeAt(n);a>=9600&&9632>=a&&t++}return t>3}function _(e){return/[\u0400-\u04FF]/.test(e)}function C(e){for(var t=0,n=0;n<e.length;n++){var a=e.charCodeAt(n);st.indexOf(a)>=0&&t++}return t>1}function x(e){return e.split(/\s/g).length<=1}function T(e){return e.length>=200}function V(e){return/^\s*\!/.test(e)}function k(e,t){return"tppbankbot"===t.toLowerCase()?lt?e.toLowerCase().indexOf("@"+lt.toLowerCase())<0:!0:!1}function S(e){return e.replace(/(.{4}.*?)(\s*?\1)+/g,"$1")}function N(e){return e.replace(/[\u0300-\u036F]/g,"")}function O(t){var n=t;return e(ct,function(e){n=n.replace(e,"")}),/^\s*$/.test(n)}function B(e){var n=c("TppBanCustomWords"),a=c("TppBannedWords");return n&&t(a,function(t){return r(e,t)})}function F(t,n){var a={};return t=t||"",n=n||"",e(R,function(e){a[e.name]=e.message_filter(t,n)}),a}function M(e){var t=Date.now();pt=t,ht=gt,gt={text:e,time:t}}function A(){gt=ht,ht=null}function D(e){var t;if(/now in slow mode/.test(e)&&(t=/(\d+) second/.exec(e))){if(ft==Number(t[1]))return!1;ft=Number(t[1])}if(/identical to the previous/.test(e)&&(t=/than (\d+) second/.exec(e),t&&(dt=Number(t[1])),A()),/you are sending messages too quickly/.test(e)){if(t=/in (\d+) second/.exec(e)){var n=Number(t[1]),a=Date.now()-gt.time+1e3*n;ft=Math.ceil(a/1e3)}A()}if(/You are banned/.test(e)){if(t=/for (\d+) more second/.exec(e)){var r=Number(t[1]);vt=Date.now()+1e3*r}A()}return I(),!0}function E(e){var t=Date.now();if(vt){var n=vt-t;if(n>0)return{blocked:!0,error:"you are banned",wait:n}}if(gt){var a=pt+mt-t;if(a>0)return{blocked:!0,error:"",wait:null};if(e===gt.text){var r=gt.time+1e3*dt-t;if(r>0)return{blocked:!0,error:"repeated message",wait:r}}var o=gt.time+1e3*ft-t;if(o>0)return{blocked:!0,error:"slowmode",wait:o}}return{blocked:!1}}function I(){var e=$(nt).val(),t=E(e),n=$(at);if(c("TppSlowmodeHelper")&&t.blocked){var a;a=t.error?"Wait "+Math.ceil(t.wait/1e3)+" seconds ("+t.error+")":"...",n.addClass(wt),n.text(a),_t=!1}else _t||(n.removeClass(wt),n.text(bt),_t=!0)}function W(){i(),d(),console.log(H)}if(window.$){var L="3.3",H="TPP Chat Filter version "+L+" loaded. Please report bugs and suggestions to https://github.com/jpgohlke/twitch-chat-filter",j=[],z=["name","comment","category","defaultValue"],P=["longComment","message_filter","message_css","message_rewriter"];s.prototype.getValue=function(){return null!==this._value?this._value:this.defaultValue},s.prototype.setValue=function(t){var n=this.getValue();this._value=t;var a=this.getValue();e(this._observers,function(e){e(a,n)})},s.prototype.reset=function(){this.setValue(null)},s.prototype.observe=function(e){this._observers.push(e)},s.prototype.forceObserverUpdate=function(){var t=this.getValue();e(this._observers,function(e){e(t,t)})};var U=[],q={},R=[],J=[],G=[],X="tpp-chat-filter-settings",Y="tpp-custom-filter-active",K="tpp-custom-filter-phrases";o(function(){e(U,function(e){e.observe(function(){p()})})});var Q=".chat-room",Z=".message",et=".from",tt=".chat-line",nt=".chat-interface textarea",at="button.send-chat-button",rt=["left","right","up","down","start","select","a","b","l","r","democracy","anarchy","wait"],ot=2;l({name:"TppFilterCommand",comment:"Emulator commands",longComment:rt.join(", "),category:"filters_category",defaultValue:!0,message_filter:y});var it=["misty","whitney","milk","guys","we have to","we need to","beat"];l({name:"TppFilterMisty",comment:"Misty meme",longComment:"Guys we need to milk Witney",category:"filters_category",defaultValue:!0,message_filter:w}),l({name:"TppFilterAscii",comment:"Blocky drawings",longComment:"Stuff like this: ░░░░▒▒▒▒▌ ▀▒▀▐▄█",category:"filters_category",defaultValue:!0,message_filter:b}),l({name:"TppFilterCyrillic",comment:"Cyrillic",longComment:"Cyrillic characters in copypastas confuse our other filters",category:"filters_category",defaultValue:!0,message_filter:_});var st=[3720,9685,664,8362,3232,176,8248,8226,7886,3237];l({name:"TppFilterDonger",comment:"Dongers",longComment:"ヽ༼ຈل͜ຈ༽ﾉ",category:"filters_category",defaultValue:!1,message_filter:C}),l({name:"TppFilterSmall",comment:"One-word messages",category:"filters_category",defaultValue:!1,message_filter:x}),l({name:"TppFilterLong",comment:"Overly long messages",longComment:"Hide messages over 200 characters (around 4 lines)",category:"filters_category",defaultValue:!1,message_filter:T}),l({name:"TppFilterBets",comment:"Stadium bets",longComment:'Any message starting with a "!". ex.: "!bet 100 blue"',category:"filters_category",defaultValue:!0,message_filter:V});var lt=null;o(function(){Twitch&&(lt=Twitch.user.displayName())}),l({name:"TppFilterBankBot",comment:"Stadium bank bot",longComment:"Messages from the bank bot about other players' balances",category:"filters_category",defaultValue:!0,message_filter:k}),l({name:"TppRewriteDuplicates",comment:"Copy pasted repetitions",category:"rewriters_category",defaultValue:!0,message_rewriter:S}),l({name:"TppMopUpDrinks",comment:"Mop up spilled drinks",category:"rewriters_category",defaultValue:!0,message_rewriter:N}),l({name:"TppConvertAllcaps",comment:"Lowercase everything",longComment:null,category:"visual_category",defaultValue:!0,message_css:Z+"{text-transform:lowercase !important;}"});var ct=[];o(function(){Twitch&&Twitch.api.get("chat/emoticons").then(function(t){e(t.emoticons,function(e){var t=e.regex;t.match(/^\w+$/)&&(t="\\b"+t+"\\b"),ct.push(new RegExp(t,"g"))})})}),l({name:"TppHideEmoticons",comment:"Hide emoticons",category:"visual_category",defaultValue:!1,message_css:Z+" .emoticon{display:none !important;}",message_filter:O}),l({name:"TppNoColor",comment:"Uncolor messages",longComment:"Remove color from messages created with the /me command",category:"visual_category",defaultValue:!1,message_css:Z+" {color:inherit !important;}"}),l({name:"TppBanCustomWords",comment:"Activate custom banlist",longComment:"",category:"customs_category",defaultValue:!1,message_css:"#menu-TppBannedWords { display:inherit; }"}),o(function(){g(["#menu-TppBannedWords { display:none; }"])}),l({name:"TppBannedWords",comment:"Banned Phrases",longComment:"If the custom banlist is activated, these messages will be hidden",category:"customs_category",defaultValue:[],message_filter:B});var ut=".chat-settings";o(function(){function t(){var e=s.height();e>0&&i.css("max-height",.9*e)}function n(e,t){e.append($("<label>").attr("for",t.name).attr("title",t.longComment||"").append($('<input type="checkbox">').attr("id",t.name)).append(document.createTextNode(" "+t.comment)));var n=$("#"+t.name);n.on("change",function(){t.setValue($(this).prop("checked"))}),t.observe(function(e){n.prop("checked",e)})}function a(t,n){function a(e){var t=n.getValue().slice();t.indexOf(e)<0&&(t.push(e),n.setValue(t))}function r(e){var t=n.getValue().slice();t.splice(e,1),n.setValue(t)}function o(){$("#show-"+n.name).show(),$("#hide-"+n.name).hide(),$("#clear-"+n.name).hide(),$("#list-"+n.name).hide()}function i(){$("#show-"+n.name).hide(),$("#hide-"+n.name).show(),$("#clear-"+n.name).show(),$("#list-"+n.name).show()}t.append($("<label>").attr("for",n.name).attr("title",n.longComment||"").append(document.createTextNode("Add "+n.comment)).append($('<input type="text">').attr("id",n.name).css("width","100%"))).append($("<button>").attr("id","show-"+n.name).append(document.createTextNode("Show ")).append($("<span>").attr("id","num-banned-"+n.name)).append(document.createTextNode(" "+n.comment))).append($("<button>").attr("id","hide-"+n.name).append(document.createTextNode("Hide "+n.comment))).append($('<div class="custom_list_menu">').attr("id","list-"+n.name)).append($("<button>").attr("id","clear-"+n.name).append(document.createTextNode("Clear "+n.comment))),o(),n.observe(function(t){$("#num-banned-"+n.name).text(t.length);var a=$("#list-"+n.name);a.empty(),e(t,function(e,t){a.append($("<li>").text(e).append($('<a href="#">').text("[X]").click(function(){r(t)})))})}),$("#"+n.name).keyup(function(e){var t=$(this).val().trim();13===e.keyCode&&""!==t&&(a(t),$(this).val(""))}),$("#show-"+n.name).click(function(e){e.preventDefault(),i()}),$("#hide-"+n.name).click(function(e){e.preventDefault(),o()}),$("#clear-"+n.name).click(function(e){e.preventDefault(),n.setValue([])})}function r(e){$('<div class="list-header"/>').text(e).appendTo(i);var t=$('<div class="chat-menu-content">').appendTo(i);return t}function o(t,r){e(U,function(e){if(e.category===r){var o=$("<p>").attr("id","menu-"+e.name).addClass("dropmenu_action").appendTo(t),i=typeof e.defaultValue;if("boolean"===i)n(o,e);else{if("object"!==i)throw new Error("Unrecognized setting "+i);a(o,e)}}})}g([".chat-room { z-index: inherit !important; }",".chat-settings { z-index: 100 !important; }",".custom_list_menu li {background: #bbb; display: block; list-style: none; margin: 1px 0; padding: 0 2px}",".custom_list_menu li a {float: right;}"]);var i=$(ut),s=$(Q);i.css("overflow-y","auto"),t(),setInterval(t,500),$(window).resize(t);var l=r("Hide");o(l,"filters_category");var c=r("Automatically rewrite");o(c,"rewriters_category");var u=r("Visual tweaks");o(u,"visual_category");var m=r("Custom Banlist");o(m,"customs_category");var f=r("Misc");f.append($("<button>Reset TPP filter settings</a>").click(function(){confirm("This will reset all Twitch Chat Filter settings to their default values and will delete all custom banned phrases. Are you sure you want to continue?")&&e(U,function(e){e.reset()})}))}),o(function(){var t=[];e(G,function(e){t.push(Q+"."+e.name+" "+e.message_css)}),g(t),e(G,function(e){e.observe(function(t){$(Q).toggleClass(e.name,t)})})}),o(function(){var t=[];e(R,function(e){var n=e.name,a=e.name+"Hidden";t.push(Q+"."+a+" "+tt+"."+n+"{display:none}"),e.observe(function(){$(Q).toggleClass(a,e.getValue())})}),g(t)}),o(function(){var t=require("web-client/components/chat-line")["default"].prototype,n=t.didInsertElement;t.didInsertElement=function(){n.apply(this,arguments);var e=this.$(),t=F(this.get("msgObject.message"),this.get("msgObject.from"));for(var a in t)e.toggleClass(a,t[a])},$(tt).each(function(){var t=$(this),n=t.find(Z).text().trim(),a=t.find(et).text().trim();e(R,function(e){t.toggleClass(e.name,e.message_filter(n,a))})})});var mt=1e3,ft=2,dt=30,pt=null,gt=null,ht=null,vt=null,yt=500,wt="tpp-slowmode-warning",bt=null,_t=!0;if(o(function(){bt=$(at).text(),g(["."+wt+"{ opacity:0.7 !important}"]),$(nt).keyup(function(e){13!==e.keyCode&&I()}),setInterval(function(){I()},yt)}),l({name:"TppSlowmodeHelper",comment:"Slowmode helper",longComment:"Shows a countdown of how long you need to wait until being able to chat again",category:"visual_category",defaultValue:!0}),o(function(){var e=require("web-client/models/room")["default"].prototype,t=e.addMessage;e.addMessage=function(e){return"admin"!==e.style||D(e.message)?t.apply(this,arguments):!1};var n=e.send;e.send=function(e){return M(e),n.apply(this,arguments)}}),$(ut).length)W();else{var $t=require("web-client/views/chat")["default"].prototype,Ct=$t.didInsertElement;$t.didInsertElement=function(){Ct&&Ct.apply(this,arguments),W()}}}});